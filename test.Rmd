---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r}
rm(list = ls())

library(Lahman)
library(mosaic)
library(tidyr)
library(tidyverse)
library(dplyr)
library(mplot)
library(ggplot2)
library(cluster)
library(factoextra)
library(corrplot)
```

```{r}
#Load in People, Batting, and Pitching Dataframes
data("People") 
data("Batting")
data("Pitching")
```

```{r}
#Merges player name to Batting data. 
bstats <- battingStats()
	str(bstats)
	

People$name <- paste(People$nameFirst, People$nameLast, sep = " ")

batting_name <- merge(Batting,
                 People[,c("playerID", "name")],
                 by = "playerID", all.x = TRUE)

#Merges player name to Pitching data.

People$name <- paste(People$nameFirst, People$nameLast, sep = " ")

pitching_name <- merge(Pitching,
                 People[,c("playerID", "name")],
                 by = "playerID", all.x = TRUE)
```

```{r}
#Creating additional stats for bstats
bstats[is.na(bstats)] = 0
#is.nan(bstats)

bstats <- bstats %>%
  mutate(K_Percent = SO / PA) %>%
  mutate(BB_Percent = (BB + IBB) / PA) %>%
  mutate_all(~replace(., is.nan(.), 0))

```

```{r}
bstats <- bstats %>%
  mutate_at(vars(K_Percent, BB_Percent), funs(round(., 3)))
```

## Data Preparation (Lesson 1 & 2)

```{r}
#Keep players with over 150 at bats. (We can change this value if necessary).
#Creating batting average variable.

batting <- bstats %>%
  filter(AB >= 150)
  
```

```{r}
bstats %>%
  filter(playerID == "bogaexa01")
```

## Exploratory Analysis (Lesson 1 & 2)
Lessons 1 and 2 will just be parts of the overall project. Simple things like data manipulation, apply functions, boxplots, etc. This will be data preparation items and exploratory analysis.

```{r}
b <- ggplot(batting, aes(x = teamID, y = HR)) +
  geom_boxplot(col = "black", aes(fill = teamID))
b

```

```{r}
hitters1 <- batting %>%
  filter(yearID < 1895) %>%
  select(SlugPct)

hitters2 <- batting %>%
  filter(yearID > 1894, yearID < 1921) %>%
  select(SlugPct)

hitters3 <- batting %>%
  filter(yearID > 1920, yearID < 1969) %>%
  select(SlugPct)

hitters4 <- batting %>%
  filter(yearID > 1969) %>%
  select(SlugPct)
#Organizing 4 different datasets looking at slugging percentage for the following boxplots. All of these are somewhat different eras, with the most dramatic split being from before 1920 (pre-Babe Ruth) and after 1920 (during and post-Babe Ruth)
```

```{r}
boxplot(hitters1,
        main = "Slugging percentage from late 1871 - 1894",
        ylab = "Slugging percentage",
        col = "blue",
        horizontal = TRUE)
```

```{r}
boxplot(hitters2, 
        main = "Slugging percentage from 1895-1920",
        ylab = "Slugging percentage",
        col = "yellow",
        horizontal = TRUE)
```

```{r}
boxplot(hitters3, 
        main = "Slugging percentage from 1921-1968",
        ylab = "Slugging percentage",
        col = "red",
        horizontal = TRUE)
```

```{r}
boxplot(hitters4, 
        main = "Slugging percentage from 1969 - present",
        ylab = "Slugging percentage",
        col = "red",
        horizontal = TRUE)
```


```{r}
sapply(hitters1, mean, na.rm = T)
sapply(hitters2, mean, na.rm = T)
sapply(hitters3, mean, na.rm = T)
sapply(hitters4, mean, na.rm = T)
#Notice that gigantic increase between hitters2 and hitters3
```

```{r}
summary(hitters1)
```

```{r}
summary(hitters2)
```

```{r}
summary(hitters3)
```

```{r}
summary(hitters4)
```

```{r}
#Keep batting stats that we want for pairs.
batting_num <- bstats %>%
  filter(PA >= 150) %>%
  select("BA", 'OBP', 'SlugPct', "SO", "BB", "HR")
  
```

```{r}
pairs(batting_num)
```
#### Career Batting Stats
```{r}
careerBatting <- na.omit(bstats)
```

```{r}
careerBatting <- careerBatting %>%
  select(playerID, BA, PA, SlugPct, OBP, SO, HR) %>%
  group_by(playerID) %>%
  summarise_all('mean')
```

```{r}
careerBatting_num <- careerBatting%>%
  filter(PA >= 150) %>%
  select(BA, PA, SlugPct, OBP, SO, HR)

pairs(careerBatting_num)
```
```{r}
corrmatrix <- cor(batting_num)
corrplot(corrmatrix, method = 'number') #Gives us correlation from pairs graph.
```

```{r}
careerBatting_num1 <- careerBatting_num %>%
  filter(PA > 500)
```


## 0-dimensional Reduction (Lesson 4)


#### Bootstrapping

## PCA (Lesson 4)
```{r}
res <- batting_num %>% prcomp(scale = TRUE)
res
```

```{r}
loadings <- res$rotation
loadings
```

```{r}
score_mat <- res$x
score_mat
```


```{r}
get_eig(res)
```

#### Screeplot
```{r}
get_eig(res) %>%
  ggplot(aes(x = 1:6, y = cumulative.variance.percent)) +
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 80) +
  xlab("Principal Component") +
  ylab("Proportion of Variance Explained") +
  ggtitle("Scree Plot of Principal Component for Batting Statistics")
```

2 Principal Components: PC1 and PC2

```{r}
fviz_screeplot(res, main = "Scree Plot")
```

Can Identify an elbow in 3.

#### Biplot
```{r}
res %>%
  fviz_pca_var(axes = c(1,2),
               col.var = "contrib",
               gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
               repel = TRUE
               )
```


## Cluster Analysis (Lesson 5)
```{r}
#NOT COMPLETE!!!!! This was just a test, bstats is way too big.
bstats_best <- bstats %>%
  filter(PA >= 600)

eu_dist <- get_dist(careerBatting_num1, method = 'euclidean')
```

```{r}
hc_complete <- hclust(eu_dist, method='complete')

plot(hc_complete)
```

#### Silhouette

```{r}
res_test <- careerBatting_num1 %>% kmeans(7)
  str(res_test)
```


```{r}
distance <- get_dist(careerBatting_num1, method="euclidean")
sil <- silhouette(x = res_test$cluster, dist = distance)
summary(sil)
sil %>% head()
```

```{r}
fviz_silhouette(sil)
```
```{r}
fviz_nbclust(careerBatting_num1, hcut, hc_method = "complete", hc_metric = "euclidean", method = "wss")
```

#### Diana

## Linear Regression (Lesson 6)

## Simple Linear Regression

## Multiple Linear Regression
